<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" name="viewport" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="apple-mobile-web-app-status-bar-style" />
		<title></title>
		<link href="css/global.css" type="text/css" rel="stylesheet">
		<link href="css/flex.css" type="text/css" rel="stylesheet">
	</head>

	<body>
		<div class="enroll_box">
			<form action="" method="post">
				<div class="form_box_out">
					<div class="form_box icon1">
						<input class="form_box_inner" type="tel" id="mobile" maxlength="11">
					</div>
					<div class="form_box icon2 flex_box row_space_between">
						<input class="form_box_yzm" placeholder="获取验证码" type="tel" maxlength="6" id='checkcode' />
						<button class="form_box_yzm_btn" id="code-btn" type="button">获取验证码</button>
						<button class="form_box_yzm_btn" id="reset-btn" type="button" style="display:none;"><span id='num'>60s</span><span style='display: none;' id='reset-title'>重新发送</span></button>
					</div>
					<input class="form_submit" type="button" id='login' value="登录" />
				</div>
			</form>
		</div>
		<script src="js/jquery-1.11.3.min.js"></script>
		<script src="js/global.js"></script>
		<script>
			var countdown = (function() {
				var phone = $('#mobile'),
					num = $("#num"),
					resetBtn = $("#reset-btn"),
					resetTitle = $("#reset-title");

				var interval = null;
				var timer = 60;
				var start = function(fn) {
					var tel = phone.val().trim();
					if(!tel) {
						alert("请输入手机号");
						return false;
					}

					if(!/^((\+?[0-9]{1,4})|(\(\+86\)))?(13[0-9]|14[57]|15[012356789]|17[0678]|18[0-9])\d{8}$/.test(tel)) {
						alert("请输入合法的手机号");
						return false;
					}
					if(timer === 60) {
						phone.prop('disabled', true);
						resetBtn.show();
						resetTitle.hide();
						num.show();
						interval = window.setInterval(function() {
							timer--;
							if(timer <= 0) {
								num.hide().text('60s');
								resetTitle.show();
								timer = 60;
								window.clearInterval(interval);
								phone.prop('disabled', false);
							} else {
								num.text(timer + "s");
							}

						}, 100);
						typeof fn === "function" && fn.apply(this, arguments);
					}
				};

				return {
					start: start
				}
			})();

			var phone = $("#mobile");
			$("#code-btn").click(function() {
				$("#code-btn").hide();
				countdown.start();
			});
			resetBtn.click(function() {
				countdown.start();
			});

			$("#login").click(function() {
				var that = $(this);
				if(!that.addClass('not')) {
					var tel = $('#mobile').val().trim();
					if(!tel) {
						alert("请输入手机号");
						return false;
					}

					if(!/^((\+?[0-9]{1,4})|(\(\+86\)))?(13[0-9]|14[57]|15[012356789]|17[0678]|18[0-9])\d{8}$/.test(tel)) {
						alert("请输入合法的手机号");
						return false;
					}

					var code = $("#checkcode").val().trim();
					if(!code) {
						alert("请输入验证码");
						return false;
					}

					if(!/d{6}/.test(code)) {
						alert("请输入合法的验证码");
						return false;
					}
					//
					$.ajax({
						type:'get',
						url:'',
						beforeSend:function(){
							that.addClass('not').val('登录中...');
						},
						success:function(data){
							data=eval("("+data+")");
						}
					});
				}
			});
		</script>
	</body>

</html>